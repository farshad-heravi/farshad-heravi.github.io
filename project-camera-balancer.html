<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two-DoF Camera Balancer | Farshad Nozad Heravi</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">Farshad Nozad Heravi</a>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">About Me</a></li>
                    <li><a href="projects.html" class="active">Projects</a></li>
                    <li><a href="skills.html">Skills</a></li>
                    <li><a href="resume.html">Resume</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="project-page-container">
            <!-- Project Header -->
            <section class="project-header">
                <h1>Two-DoF Camera Balancer</h1>
                <p class="subtitle">An Embedded Real-Time Stabilization System for Mobile Robot Navigation.</p>
                <div class="project-info-bar">
                    <div><strong><i class="fas fa-calendar-alt"></i> Timeline:</strong> 2024 - 2025</div>
                    <div><strong><i class="fas fa-flask"></i> Type:</strong> Embedded Systems / Hardware / Control</div>
                    <div><strong><i class="fas fa-user"></i> Role:</strong> Embedded Control & Software Developer</div>
                </div>
            </section>

            <!-- Hero Media -->
            <section class="project-hero-media">
                <img src="media/images/project_camera_balancer_img2.jpg"
                    alt="Camera balancer installed on top of the rover" 
                    style="width:80%; border-radius: 8px; display: block; margin: 0 auto;">
            </section>

            <!-- Project Overview -->
            <section class="project-overview">
                <h2>Project Overview</h2>
                <div class="overview-grid">
                    <div>
                        <h3><i class="fas fa-industry"></i>The Challenge & My Objective</h3>
                        <p style="text-align: justify;">
                            Wheeled robots operating in unstructured environments, such as the historical archeological site of Pompeii, face a significant challenge: uneven terrain induces severe roll and pitch movements. This motion results in blurred images and unstable video feeds, rendering vision-based tasks like automated defect detection ineffective.
                        </p>
                        <p style="text-align: justify;">
                            The objective of this project was to design and build a compact, low-cost, and effective <b>2-DoF camera stabilization system</b>. The goal was to actively compensate for the rover's inclinations in real-time, providing a consistently level and stable platform for its cameras to ensure blur-free image captures.
                        </p>
                    </div>
                    <div>
                        <h3><i class="fas fa-check-circle"></i> Key Outcomes</h3>
                        <ul>
                            <li>Developed a real-time Kalman filter on an Arduino, achieving an <b>85% reduction</b> in multi-IMU sensor fusion to reduce the noise and drift.</li>
                            <li>Implemented a PID controller for precise and responsive compensation of roll and pitch angles.</li>
                            <li>Integrated the system with ROS2 for high-level communication and visual servoing control.</li>
                        </ul>
                        <h3><i class="fas fa-cogs"></i> Tech Stack</h3>
                        <div class="project-tags">
                            <span class="tag">C++</span> <span class="tag">Python</span> <span class="tag">ROS2</span> <span class="tag">Arduino</span> <span class="tag">Kalman Filter</span> <span class="tag">PID Control</span>
                        </div>
                    </div>
                </div>
                 <!-- My Contribution Section -->
                <div style="margin-top: 2rem;">
                     <h3><i class="fas fa-user-cog"></i> My Contribution</h3>
                     <p style="text-align: justify;">I was responsible for the embedded software development of the camera balancer system. My core contributions were the design of a Kalman filter for robust state estimation and the implementation of the real-time PID control loop on the Arduino UNO board.</p>
                </div>
            </section>
            
            <!-- Technical Deep Dive -->
            <section class="technical-deep-dive">
                <h2>Technical Deep Dive</h2>
                <div class="deep-dive-grid">
                    <div class="dive-item">
                        <h3>Hardware Design & Integration</h3>
                        <p style="text-align: justify;">The system was designed in SolidWorks and fabricated using 3D printing. The hardware consists of an Arduino UNO as the main microcontroller, two BNO055 IMUs for orientation sensing, and two DC motors to actuate the roll and pitch axes. An L298N H-bridge motor driver interfaces with the Arduino to provide sufficient current to the motors. The entire control loop runs on the Arduino, which communicates its state and receives high-level commands from a host computer via a ROS2 serial connection.</p>
                    </div>
                    <div class="dive-item">
                        <h3>Embedded PID Controller</h3>
                        <p style="text-align: justify;">The heart of the system is a real-time <b>PID control loop</b> running entirely on the Arduino UNO. In each cycle, the loop: (i) Reads the latest IMU data. (ii) Processes it through the Kalman filter to obtain a clean estimate of the roll and pitch angles. (iii) Compares these angles to the desired setpoint (0 degrees, or visual servoing input). (iv) The PID controller then calculates the required motor output to compensate for the error, ensuring the camera platform remains stable and aligned with the desired direction as the base moves.</p>
                    </div>
                </div>
            </section>
            
            <!-- Media Gallery -->
            <section class="media-gallery">
                <h2>Gallery</h2>
                <div class="gallery-grid">
                    <!-- CAD of the Camera Balancer -->
                    <div class="gallery-item" onclick="openModal('media/images/project_camera_balancer_img6.png',
                            'CAD of the Camera Balancer',
                            'Detailed CAD rendering showing the complete assembly of the Camera Balancer.')">
                        <img src="media/images/project_camera_balancer_img6.png" 
                        alt="The CAD of the camera balancer">
                        
                        <div class="image-description">
                            <h4 style="text-align: center;">CAD of the Camera Balancer</h4>
                        </div>
                    </div>

                    <!-- SW & HW schematics of the Camera Balancer -->
                     <div class="gallery-item" onclick="openModal('media/images/DDB_schematics.png',
                             'SW & HW schematics',
                             'System architecture diagram showing the complete control loop of the camera balancer. The software section includes Visual Module, Kalman Filter, and PID Controller that process data from cameras and IMUs. The hardware section contains the sensors (cameras, IMUs) and actuators (roll and pitch DC motors). This closed-loop system enables real-time stabilization by combining visual and inertial feedback to actively compensate for rover movements.',
                             ['media/images/DDB_ros_map.png'],
                             ['ROS node architecture showing the distributed system where camera and vision nodes run on the rover\'s NUC PC, while the controller node runs on the Arduino board. The nodes communicate over serial communication, with the PC handling sensor data processing and the Arduino executing real-time control algorithms for motor actuation.'])">
                        <img src="media/images/DDB_schematics.png" 
                        alt="The SW & HW schematics">
                        
                        <div class="image-description">
                            <h4 style="text-align: center;">SW & HW schematics</h4>
                        </div>
                    </div>

                    <div class="gallery-item" onclick="openModal('media/videos/testing_ddb_on_spot.mp4',
                        'Camera Balancer in Action',
                        'Real-time demonstration of the camera balancer installed on Spot robot, stabilizing the camera platform while the robot moves over obstacles. The performance of the system compared to the wheeled rover was significantly worse due to impulse accelerations caused by the robot\'s movement.',
                        ['media/videos/testing_ddb_on_Go2.mp4', 'media/videos/testing_ddb_on_rover.mp4'],
                        ['Testing the camera balancer on Go2 legged robot. The test was aimed to record sensor reading while the robot walk over flat surface in order to improve the performance of the controller.',
                        'Testing the camera balancer on wheeled rover. The test was aimed to record videos from the walls of Pompeii historical site in order to perform defect detection.'])")>
                        <img src="media/images/testing_ddb_thumbnail.png" alt="Camera balancer in action">
                        <div class="image-description">
                            <h4 style="text-align: center;">Camera Balancer in Action</h4>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Image Modal Overlay -->
            <div id="imageModal" class="modal-overlay" onclick="closeModal()">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <span class="close-btn" onclick="closeModal()">&times;</span>
                    
                    <!-- Media Container -->
                    <div class="modal-media-container">
                        <img id="modalImage" src="" alt="Modal Image" style="display: none;">
                        <video id="modalVideo" controls style="display: none;">
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        
                        <!-- Navigation Arrows -->
                        <button class="modal-nav-btn modal-prev" onclick="changeImage(-1)">&lt;</button>
                        <button class="modal-nav-btn modal-next" onclick="changeImage(1)">&gt;</button>
                    </div>
                    
                    <!-- Image Counter -->
                    <div class="image-counter">
                        <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
                    </div>
                    
                    <!-- Dots Indicator -->
                    <div class="dots-indicator" id="dotsContainer">
                        <span class="dot active" onclick="goToImage(0)"></span>
                    </div>
                    
                    <div class="modal-description">
                        <h3 id="modalTitle"></h3>
                        <p id="modalText"></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
             <p><a href="projects.html" style="color: white; text-decoration: underline;">Back to All Projects</a></p>
            <div class="social-icons">
                <a href="mailto:f.n.heravi@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a>
                <a href="https://www.linkedin.com/in/fheravi" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="https://github.com/farshad-heravi" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
            </div>
            <p>&copy; 2025 Farshad Nozad Heravi</p>
        </div>
    </footer>

    <!-- JavaScript for Modal Functionality -->
    <script>
        let currentImages = [];
        let currentImageIndex = 0;
        let currentDescriptions = [];
        
        function openModal(imageSrc, title, description, additionalImages = [], additionalDescriptions = []) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalText = document.getElementById('modalText');
            
            // Set up images array
            currentImages = [imageSrc, ...additionalImages];
            currentImageIndex = 0;
            
            // Set up descriptions array
            currentDescriptions = [description, ...additionalDescriptions];
            
            // Update modal content
            updateModalImage();
            updateModalDescription();
            
            // Update counter and dots
            updateImageCounter();
            updateDotsIndicator();
            
            // Show/hide navigation based on number of images
            const prevBtn = document.querySelector('.modal-prev');
            const nextBtn = document.querySelector('.modal-next');
            const navBtns = document.querySelectorAll('.modal-nav-btn');
            
            if (currentImages.length > 1) {
                navBtns.forEach(btn => btn.style.display = 'block');
            } else {
                navBtns.forEach(btn => btn.style.display = 'none');
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Add fade-in animation
            setTimeout(() => {
                modal.classList.add('modal-active');
            }, 10);
        }
        
        function updateModalImage() {
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');
            const currentSrc = currentImages[currentImageIndex];
            
            // Check if the current item is a video
            const isVideo = currentSrc.match(/\.(mp4|avi|mov|wmv|flv|webm)$/i);
            
            if (isVideo) {
                // Show video, hide image
                modalImage.style.display = 'none';
                modalVideo.style.display = 'block';
                modalVideo.src = currentSrc;
            } else {
                // Show image, hide video
                modalVideo.style.display = 'none';
                modalImage.style.display = 'block';
                modalImage.src = currentSrc;
            }
        }
        
        function updateModalDescription() {
            const modalTitle = document.getElementById('modalTitle');
            const modalText = document.getElementById('modalText');
            
            // Use the first description as the title for all images
            modalTitle.textContent = modalTitle.textContent || 'Image Gallery';
            
            // Update description based on current image
            if (currentDescriptions[currentImageIndex]) {
                modalText.textContent = currentDescriptions[currentImageIndex];
            }
        }
        
        function updateImageCounter() {
            document.getElementById('currentImageIndex').textContent = currentImageIndex + 1;
            document.getElementById('totalImages').textContent = currentImages.length;
        }
        
        function updateDotsIndicator() {
            const dotsContainer = document.getElementById('dotsContainer');
            dotsContainer.innerHTML = '';
            
            for (let i = 0; i < currentImages.length; i++) {
                const dot = document.createElement('span');
                dot.className = `dot ${i === currentImageIndex ? 'active' : ''}`;
                dot.onclick = () => goToImage(i);
                dotsContainer.appendChild(dot);
            }
        }
        
        function changeImage(direction) {
            currentImageIndex = (currentImageIndex + direction + currentImages.length) % currentImages.length;
            updateModalImage();
            updateModalDescription();
            updateImageCounter();
            updateDotsIndicator();
        }
        
        function goToImage(index) {
            currentImageIndex = index;
            updateModalImage();
            updateModalDescription();
            updateImageCounter();
            updateDotsIndicator();
        }
        
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('modal-active');
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                currentImages = [];
                currentImageIndex = 0;
                currentDescriptions = [];
            }, 300);
        }
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        // Arrow key navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                if (currentImages.length > 1) changeImage(-1);
            } else if (event.key === 'ArrowRight') {
                if (currentImages.length > 1) changeImage(1);
            }
        });
    </script>
</body>
</html>
